<header tuiHeader class="m-1">
  <h1 tuiTitle>Carga Acad√©mica</h1>
</header>

<section class="container-fluid">

  <tui-accordion>

    <!-- ========================================================= -->
    <!--   1. ACORDE√ìN ‚Äî HORARIO SEMANAL (TIPO DESPLEGABLE)       -->
    <!-- ========================================================= -->
    <tui-accordion-item>
      <button tuiAccordionItemHeader>üìÖ Horario Semanal - Docentes Delegados</button>

      <div class="accordion-content">

        <div class="schedule-grid">
          @for (day of daysOfWeekStrings; track day) {
            <div class="day-card">

              <!-- HEADER DEL D√çA (Clickeable) -->
              <div
                class="day-header"
                [class.expanded]="expandedDays[day]"
                (click)="toggleDay(day)">
                <span>{{ day }}</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span class="day-count">
                    {{ (academicLoadByDay[day] || []).length }}
                  </span>
                  <mat-icon>expand_more</mat-icon>
                </div>
              </div>

              <!-- CONTENIDO DEL D√çA (Desplegable) -->
              <div
                class="day-content"
                [class.expanded]="expandedDays[day]">

                @if ((academicLoadByDay[day] || []).length > 0) {
                  @for (load of academicLoadByDay[day]; track load.id) {
                    <div class="teacher-item">
                      <strong>{{ load.fullName }}</strong>
                      <span>{{ load.subjectName }} ‚Ä¢ {{ load.groupName }}</span>
                    </div>
                  }
                } @else {
                  <div class="empty-day">
                    Sin docentes asignados
                  </div>
                }

              </div>

            </div>
          }
        </div>

      </div>
    </tui-accordion-item>


    <!-- ========================================================= -->
    <!--   2. ACORDE√ìN ‚Äî GESTI√ìN DE DOCENTES                      -->
    <!-- ========================================================= -->
    <tui-accordion-item>
      <button tuiAccordionItemHeader>üë®‚Äçüè´ Gesti√≥n de Docentes y Cargas Acad√©micas</button>

      <div class="accordion-content">

        <!-- LISTADO SIMPLE REUTILIZADO -->
        <app-simple-teacher-list
          [teachers]="teachers"
          (teacherSelected)="onTeacherSelected($event)">
        </app-simple-teacher-list>

        <!-- CONTENIDO AL SELECCIONAR UN DOCENTE -->
        <div *ngIf="selectedTeacher" class="teacher-details">

          <h4>üìã Gesti√≥n de: {{ selectedTeacher.fullName }}</h4>

          <!-- ============================================== -->
          <!--   SECCI√ìN A ‚Äî CARGAS ACAD√âMICAS ACTUALES       -->
          <!-- ============================================== -->
          <div class="section">
            <h5>üìö Cargas Acad√©micas Actuales</h5>

            <div class="academic-loads-table">
              @if (getTeacherLoads(selectedTeacher.id).length > 0) {
                @for (load of getTeacherLoads(selectedTeacher.id); track load.id) {
                  <div class="load-row">

                    <div class="load-info">
                      <div class="load-subject">{{ load.subjectName }}</div>
                      <div class="load-details">
                        <span>üè´ {{ load.groupName }}</span>
                        <span>üìÖ {{ load.days.join(', ') }}</span>
                      </div>
                    </div>

                    <div class="load-actions">
                      <button
                        class="btn-delete"
                        (click)="deleteAcademicLoad(load.id)"
                        title="Eliminar carga">
                        <mat-icon>delete</mat-icon>
                        Eliminar
                      </button>
                    </div>

                  </div>
                }
              } @else {
                <div class="no-loads">
                  Este docente no tiene cargas acad√©micas asignadas
                </div>
              }
            </div>

          </div>

          <!-- ============================================== -->
          <!--   SECCI√ìN B ‚Äî ASIGNAR NUEVA CARGA ACAD√âMICA    -->
          <!-- ============================================== -->
          <div class="section">
            <h5>‚ûï Asignar Nueva Carga Acad√©mica</h5>

            <form [formGroup]="academicLoadForm" (ngSubmit)="submitAcademicLoad()">

              <div class="form-row">
                <mat-form-field>
                  <mat-label>Materia</mat-label>
                  <mat-select formControlName="subjectId">
                    <mat-option *ngFor="let subject of subjects" [value]="subject.id">
                      {{ subject.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field>
                  <mat-label>Grupo</mat-label>
                  <mat-select formControlName="groupId">
                    <mat-option *ngFor="let group of groups" [value]="group.id">
                      {{ group.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="days-selection">
                <h6>D√≠as de la semana:</h6>

                <div class="checkboxes">
                  @for (day of daysOfWeek; track day.value) {
                    <mat-checkbox
                      [checked]="isDaySelected(day.value)"
                      (change)="onDayChange(day, $event.checked)">
                      {{ day.name }}
                    </mat-checkbox>
                  }
                </div>
              </div>

              <button mat-raised-button color="primary"
                type="submit" [disabled]="!academicLoadForm.valid">
                <mat-icon>add</mat-icon>
                Asignar Carga
              </button>

            </form>

          </div>

        </div>

      </div>

    </tui-accordion-item>

  </tui-accordion>

</section>
